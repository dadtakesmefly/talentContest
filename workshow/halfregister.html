<!DOCTYPE html>
<html>
<head lang="en">
    <!--<meta charset="UTF-8">-->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <link rel="stylesheet" href="css/base.css"/>
    <link rel="stylesheet" href="css/halfregister.css"/>
    <script src="jquery-1.8.3/jquery.min.js"></script>
    <script src="layer/layer.js"></script>

    <title>报名参赛_留守儿童才艺大赛</title>
    <style>
        body .demo-class .layui-layer-title{background:#E74538; color:#fff; border: none;}
        body .demo-class .layui-layer-btn a {background:#E74538;}
        body .demo-class .layui-layer-btn a {border: none}
        body .demo-class .layui-layer-btn .layui-layer-btn1{background:#999;}
        .layui-layer-setwin .layui-layer-max {
            background-position: -32px -40px;
            display: none !important;
        }
        .layui-layer-min{
            display: none !important;
        }
    </style>
</head>
<body>
<div class="top">
    <img src="images/红色头顶.png" alt=""/>
</div>
 <!--<div class="step">-->
     <!--<div class="inner">-->
     <!--<ul>-->
         <!--<li>报名参加活动</li>-->
         <!--<li>上传参赛作品(在5月21日前必须上传)</li>-->
         <!--<div class="border"></div>-->
     <!--</ul>-->

     <!--</div>-->
 <!--</div>-->
<form class="myform" id="myform" action="">
    <h3 class="title">辅导学校或公益团队信息</h3>
    <input class="organization" required name="organization" id="organization" type="text" placeholder="请填写辅导学校或公益团队名称"/>
    <div class="diqu">
        <select name="area" class="area" id="area">
            <option value="所在区域">所在区域</option>
            <option value="武都区">武都区</option>
            <option value="宕昌">宕昌</option>
            <option value="文县">文县</option>
            <option value="康县">康县</option>
            <option value="成县">成县</option>
            <option value="徽县">徽县</option>
            <option value="礼县">礼县</option>
            <option value="西和">西和县</option>
            <option value="两当">两当县</option>
        </select>
        <img class="arrow" src="images/arrow.png" alt=""/>
    </div>

    <span class="tips">本次活动仅限陇南八县一区</span>
    <input name="person" type="text" class="person" id="person" placeholder="活动负责人姓名"/>
    <input name="telphone" type="tel" class="telphone" id="telphone" placeholder="活动负责人联系方式"/>

    <!--<h3 class="title" id="fudao">辅导老师(志愿者)信息</h3>-->

    <!--<div class="addtitle">-->
        <!--<input name="teacher" type="text" class="teacher" id="teacher" placeholder="请填写辅导员老师姓名"/>-->
        <!--<input name="teachertel" type="tel" class="teachertel" id="teachertel" placeholder="请填写辅导员老师联系方式"/>-->
    <!--</div>-->
    <!--<div class="addtitle1" style="display: none">-->
        <!--<input name="teacher" type="text" class="teacher" id="teacher1" placeholder="请填写辅导员老师姓名"/>-->
        <!--<input name="teachertel" type="tel" class="teachertel" id="teachertel1" placeholder="请填写辅导员老师联系方式"/>-->
        <!--<span class="remove"><img src="images/移除.png" alt=""/>移除</span>-->
    <!--</div>-->
    <!--<div class="addd"></div>-->

    <!--<span class="add" id="add">增加辅导老师</span>-->

    <!--<h3 class="title">参赛儿童信息</h3>-->
    <!--<input name="child" type="text" class="child" id="child" placeholder="请填写参赛儿童姓名"/>-->
    <!--<div class="uploadchild"><span>上传参赛儿童照片</span><i class="tipsss"></i></div>-->
    <!--<input  id="hold" name="childUrl" style="display: none" value="" type="text"/>-->
    <!--<input id="school" name="school" name="school" placeholder="参赛儿童所在学校" type="text"/>-->

    <input style="display: none" id="actphone" name="actRegisterPhone" value=""  type="text"/>
    <input type="button" id="sbm" class="sbm" value="提交信息"/>
</form>
</body>
 <!--站长统计 start-->
<div style="display:none">
    <script src="lib/total.js"></script>
</div>
 <!--站长统计 end -->
<script>



//    var baseUrl = "http://192.168.31.248:7070/AXGY_OP/"; //本地联调地址
//     var baseUrl = "https://rest.cnaisin.com:8443/AXGY_OP/";
     var baseUrl = "https://rest.cnaisin.com:15443/AXGY_OP/"; //product
    var enrollmentUrl = baseUrl + "enrollment"; //报名参赛接口

    $.fn.serializeObject = function()
    {
        var list=[];
        var name=[];
        var phone=[];
        var a = this.serializeArray();
        $.each(a, function(index,obj) {

            if (obj.name == 'teacher') {
                name.push(obj.value)
            }
            if (obj.name == 'teachertel') {
                phone.push(obj.value)
            }
        });
        for(var i=0;i<name.length;i++){
            var o={};
            if(name[i]!=""|| phone[i]!=""){
                o.name=name[i];
                o.phone=phone[i];
                list.push(o);
            }
        }
        var key= a.length+1
        var v={"name":"teacherTel","value":JSON.stringify(list)}
        a[key]=v;
        return a;
    };

    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);  //获取url中"?"符后的字符串并正则匹配
        var context = "";
        if (r != null)
            context = r[2];
        reg = null;
        r = null;
        return context == null || context == "" || context == "undefined" ? "" : context;
    }
    var actphone=GetQueryString("actRegisterPhone");
    console.log(GetQueryString("actRegisterPhone"));
    $("#actphone").attr("value",actphone);

    /*让文字和标签的大小随着屏幕的尺寸做变话 等比缩放*/
    var html = document.getElementsByTagName('html')[0];
    var width = window.innerWidth;
    var fontSize = 100/640*width;
    if(width>640){
        fontSize=100;
    }
    html.style.fontSize = fontSize +'px';
    window.onresize = function(){
        var html = document.getElementsByTagName('html')[0];

        var width = window.innerWidth;

        var fontSize = 100/640 * width;

        html.style.fontSize = fontSize +'px';
    }
//    $(function () {
//        $("#add").on("click", function () {
//            $(".addd").first().append($(".addtitle1:first").first().clone(true).attr('class',"addtitle1 clone").attr("style","display:block"));
//            $(".remove").on("click", function () {
//                $(this).parent(".clone").remove();
//            })
//        });
//    })
//    $(".uploadchild").on("click", function () {
//            layer.open({
//                    type: 2,
//                    title: '上传参赛儿童照片',
//                    shadeClose: true,
//                    shade: false,
//                    maxmin: true, //开启最大化最小化按钮
//                    area: ['100%', '100%'],
//                    content: './singlepic.html'
//                });
//    })
    $("#sbm").on("click", function () {
        $("#myform").serializeObject();
        console.log($("#myform").serializeObject());
        $.ajax({
            url:enrollmentUrl,
            type:"post",
            data:$("#myform").serializeObject(),
            success: function (data) {
                console.log(data)
                if(data.ok==true){
                    layer.open({
                        skin:"demo-class",
                        title:"提示",
                        content:"提交成功",
                        end: function () {
                            window.location.href='./worklist.html'+"?actRegisterPhone="+actphone
                        }
                    })

                }
                else if(data.msg=="提交失败" ){
                    layer.open({
                        skin:"demo-class",
                        title:"提示",
                        content:"提交失败"
                    })

                }
                else if(data.exCode==""){
                    layer.open({
                        skin:"demo-class",
                        title:"提示",
                        content:"请填写必填项"
                    })
                }
                else if(data.exCode=="RepeatedSubmit"){
                    layer.open({
                    skin:"demo-class",
                    title:"提示",
                    content:"请不要重复提交"
                })}
                else{
                    layer.open({
                        skin:"demo-class",
                        title:"提示",
                        content:"提交失败"
                    })
                }
            }
        })
    })
</script>
</html>